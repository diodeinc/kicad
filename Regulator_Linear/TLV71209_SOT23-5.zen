"""TLV71209_SOT23-5 - 300mA Low-IQ Low-Dropout Regulator with 0.9V Fixed Output

The TLV71209 is a low quiescent current (35μA typical) LDO linear regulator 
capable of supplying 300mA of output current. It features sub-bandgap output 
voltage of 0.9V with 2% accuracy and operates from 2.0V to 5.5V input voltage. 
The device provides excellent line and load transient performance with 68dB PSRR 
at 1kHz. It includes thermal shutdown, overcurrent protection, and an enable pin 
for power management. The regulator is stable with only 0.1μF effective output 
capacitance, making it ideal for battery-operated handheld equipment requiring 
low power consumption and small solution size.

Author: @anthropic/claude-opus-4
Reviewer: Nasheed Ur Rehman
Datasheet: https://www.ti.com/lit/ds/symlink/tlv712.pdf
"""
load("@stdlib/interfaces.zen", "Ground", "NotConnected")

# Dependencies
Resistor = Module("@stdlib/generics/Resistor.zen")
Capacitor = Module("@stdlib/generics/Capacitor.zen")

# Configuration
add_input_cap = config("add_input_cap", bool, default = True)
add_output_cap = config("add_output_cap", bool, default = True)
enable_control = config("enable_control", bool, default = True)
if enable_control:
    add_enable_pullup = config("add_enable_pullup", bool, default = True)

# External IO
VIN = io("VIN", Net, default = Net("VIN"))
VOUT = io("VOUT", Net, default = Net("VOUT"))
EN_CTRL = io("EN", Net, default = Net("EN")) if enable_control else VIN
GND = io("GND", Ground)

# Internal nets
_NC = NotConnected()

# 300mA Low Dropout Voltage Regulator, Fixed Output 0.9V, SOT-23-5
Component(
    name = "TLV71209_SOT23-5",
    symbol = Symbol(library = "@kicad-symbols/Regulator_Linear.kicad_sym", name = "TLV71209_SOT23-5"),
    footprint = File("@kicad-footprints/Package_TO_SOT_SMD.pretty/SOT-23-5.kicad_mod"),
    pins = {
        "IN": VIN,
        "EN": EN_CTRL,
        "GND": GND,
        "NC": _NC,
        "OUT": VOUT
    },
)

# Input Capacitor - Datasheet recommends 1μF ceramic
if add_input_cap:
    Capacitor(name = "C_IN", value = "1uF", package = "0603", P1 = VIN, P2 = GND)

# Output Capacitor - Required for stability, minimum 0.1μF effective capacitance
if add_output_cap:
    # Main output capacitor (1μF provides good transient response)
    Capacitor(name = "C_OUT", value = "1uF", package = "0603", P1 = VOUT, P2 = GND)

# Enable Control
if enable_control:
    # Optional pull-up resistor to ensure regulator is enabled by default
    if add_enable_pullup:
        Resistor(name = "R_EN", value = "100kohms", package = "0402", P1 = EN_CTRL, P2 = VIN)


# pcb:sch TLV71209_SOT23-5 x=-39.1000 y=-20.0500 rot=0
# pcb:sch C_IN.C x=-199.1200 y=11.7000 rot=0
# pcb:sch C_OUT.C x=156.4800 y=24.4000 rot=0
# pcb:sch GND.1 x=24.4000 y=164.1000 rot=0
# pcb:sch R_EN.R x=-125.4600 y=24.4000 rot=180