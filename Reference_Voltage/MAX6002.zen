"""MAX6002 - Low-Cost, Low-Power, Low-Dropout, SOT23-3 Voltage Reference

The MAX6002 is a precision 2.500V series voltage reference that combines low power consumption, 
high accuracy, and low dropout voltage in a compact SOT23-3 package. It features ±1% initial 
accuracy, 100ppm/°C maximum temperature coefficient, and operates from a wide 2.7V to 12.6V 
input voltage range. The device draws only 45µA maximum quiescent current and can source or 
sink up to 400µA while maintaining excellent regulation. With only 100mV typical dropout at 
400µA load, it's ideal for low-voltage battery-powered applications.

Key features:
- 2.500V ±1% output voltage
- 100ppm/°C max temperature coefficient
- 2.7V to 12.6V input voltage range
- 45µA max quiescent current
- 100mV dropout at 400µA load (typ)
- ±400µA output current capability
- No output capacitor required (stable with 0 to 2.2nF)
- -40°C to +85°C operating temperature range
- SOT23-3 package

Author: @anthropic/claude-opus-4
Reviewer: Nasheed Ur Rehman
Datasheet: https://www.analog.com/media/en/technical-documentation/data-sheets/MAX6001-MAX6005.pdf
"""

# Dependencies
Resistor = Module("@stdlib/generics/Resistor.zen")
Capacitor = Module("@stdlib/generics/Capacitor.zen")
TestPoint = Module("@stdlib/generics/TestPoint.zen")

# Types
InputFilterConfiguration = enum("None", "RC", "Capacitor")
OutputConfiguration = enum("Direct", "Filtered")

# Configuration
# Input filtering configuration
input_filter_config = config("input_filter_config", InputFilterConfiguration, default = "RC")
if input_filter_config == InputFilterConfiguration("RC"):
    input_filter_r_value = config("input_filter_r_value", str, default = "10ohms")
    input_filter_c_value = config("input_filter_c_value", str, default = "1uF")
elif input_filter_config == InputFilterConfiguration("Capacitor"):
    input_filter_c_value = config("input_filter_c_value", str, default = "1uF")

# Output configuration
output_config = config("output_config", OutputConfiguration, default = "Filtered")
if output_config == OutputConfiguration("Filtered"):
    output_cap_value = config("output_cap_value", str, default = "1nF")  # Max 2.2nF for stability

# Test points
add_test_points = config("add_test_points", bool, default = True)

# External IO
VIN = io("VIN", Net, default = Net("VIN", symbol = Symbol("@kicad-symbols/power.kicad_sym:VDD")))
GND = io("GND", Net, default = Net("GND", symbol = Symbol("@kicad-symbols/power.kicad_sym:GND")))
VREF = io("VREF", Net, default = Net("VREF_2V5"))

# Internal nets
if input_filter_config == InputFilterConfiguration("RC"):
    _VIN_FILTERED = Net("VIN_FILTERED")
else:
    _VIN_FILTERED = VIN

# Main component
Component(
    name = "MAX6002",
    symbol = Symbol(library = "@kicad-symbols/Reference_Voltage.kicad_sym", name = "MAX6002"),
    footprint = File("@kicad-footprints/Package_TO_SOT_SMD.pretty/SOT-23.kicad_mod"),
    pins = {
        "IN": _VIN_FILTERED,   # Pin 1 - Supply input
        "OUT": VREF,           # Pin 2 - Reference output
        "GND": GND,            # Pin 3 - Ground
    },
)

# Input filtering
if input_filter_config == InputFilterConfiguration("RC"):
    # Series resistor for RC filter
    Resistor(
        name = "R_FILTER",
        value = input_filter_r_value,
        package = "0603",
        P1 = VIN,
        P2 = _VIN_FILTERED,
    )
    # Filter capacitor
    Capacitor(
        name = "C_FILTER",
        value = input_filter_c_value,
        voltage = "16V",
        package = "0805",
        P1 = _VIN_FILTERED,
        P2 = GND,
    )
elif input_filter_config == InputFilterConfiguration("Capacitor"):
    # Input bypass capacitor only
    Capacitor(
        name = "C_IN",
        value = input_filter_c_value,
        voltage = "16V",
        package = "0805",
        P1 = VIN,
        P2 = GND,
    )

# Output configuration
if output_config == OutputConfiguration("Filtered"):
    # Output capacitor for transient response
    # Note: MAX6002 is stable with 0-2.2nF output capacitance
    Capacitor(
        name = "C_OUT",
        value = output_cap_value,
        voltage = "6.3V",
        package = "0603",
        P1 = VREF,
        P2 = GND,
    )

# Test points (optional)
if add_test_points:
    TestPoint(name = "TP_VIN", variant = "THTPad_D1.0mm_Drill0.5mm", P1 = VIN)
    TestPoint(name = "TP_VREF", variant = "THTPad_D1.0mm_Drill0.5mm", P1 = VREF)
    TestPoint(name = "TP_GND", variant = "THTPad_D1.0mm_Drill0.5mm", P1 = GND)

# PCB placement hints for optimal layout
# Place input capacitors close to pin 1 (IN)
# Keep ground connections short to pin 3 (GND)
# Output trace from pin 2 (OUT) should be kept away from noisy signals
# pcb:sch MAX6002 x=75.2000 y=100.6000 rot=0
# pcb:sch C_IN.C x=-46.7200 y=138.7000 rot=0
# pcb:sch GND.1 x=87.9000 y=291.1000 rot=0
# pcb:sch VIN.1 x=-173.7200 y=37.1000 rot=0
# pcb:sch TP_VIN.TP x=-199.1200 y=47.2600 rot=270
# pcb:sch TP_VREF.TP x=219.9800 y=72.6600 rot=0
# pcb:sch TP_GND.TP x=-46.7200 y=250.4600 rot=180
# pcb:sch C_FILTER.C x=-59.4200 y=138.7000 rot=0
# pcb:sch R_FILTER.R x=-112.7600 y=49.8000 rot=270
# pcb:sch C_OUT.C x=270.7800 y=189.5000 rot=0